<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>我的生活</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="http://g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css">

</head>
<body>

    <div class="page-group">
        <div id="page-fixed-tab-infinite-scroll" class="page">
            <header class="bar bar-nav">
                <a class="icon icon-left pull-left"></a>
                <h1 class="title">订单管理</h1>
            </header>
            <div class="bar bar-standard bar-footer">
                <a class="icon icon-edit pull-left"></a>
                <a class="icon icon-settings pull-right"></a>
            </div>
            <div class="content" data-type="">
                <div class="buttons-tab fixed-tab" data-offset="44">
                    <a href="#tab1" class="tab-link active button">全部</a>
                    <a href="#tab2" class="tab-link button">待付款</a>
                    <a href="#tab3" class="tab-link button">待发货</a>
                    <a href="#tab2" class="tab-link button">待收货</a>
                    <a href="#tab3" class="tab-link button">待评价</a>
                </div>

                <div class="tabs tabs-content">
                    <div id="tab1" class="tab infinite-scroll pull-to-refresh-content active">
                        <!--下拉提示符-->
                        <div class="pull-to-refresh-layer">
                            <div class="preloader"></div>
                            <div class="pull-to-refresh-arrow"></div>
                        </div>
                        <div class="card-container">
                            <div class="card">
                                <div class="card-header">card</div>
                                <div class="card-content">
                                    <div class="card-content-inner">
                                        这里是第1个card，下拉刷新会出现第2个card。
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="list-block">
                            <ul class="list-container">
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                            </ul>
                        </div>
                        <!-- 加载提示符 -->
                        <div class="infinite-scroll-preloader">
                            <div class="preloader">
                            </div>
                        </div>
                    </div>
                    <div id="tab2" class="tab infinite-scroll">
                        <div class="list-block">
                            <ul class="list-container">
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                            </ul>
                        </div>
                        <!-- 加载提示符 -->
                        <div class="infinite-scroll-preloader">
                            <div class="preloader">
                            </div>
                        </div>
                    </div>
                    <div id="tab3" class="tab infinite-scroll">
                        <div class="list-block">
                            <ul class="list-container">
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                                <li class="item-content"><div class="item-inner"><div class="item-title">条目</div></div></li>
                            </ul>
                        </div>
                        <!-- 加载提示符 -->
                        <div class="infinite-scroll-preloader">
                            <div class="preloader">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type='text/javascript' src='http://g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
    <script>
        $(function () {
            $(function () {
                'use strict';

                //下拉刷新页面
                $(document).on('refresh', '.pull-to-refresh-content', function (e) {
                    // 模拟2s的加载过程
                    setTimeout(function () {
                        var cardNumber = $(e.target).find('.card').length + 1;
                        var cardHTML = '<div class="card">' +
                                          '<div class="card-header">card' + cardNumber + '</div>' +
                                          '<div class="card-content">' +
                                            '<div class="card-content-inner">' +
                                                '这里是第' + cardNumber + '个card，下拉刷新会出现第' + (cardNumber + 1) + '个card。' +
                                            '</div>' +
                                          '</div>' +
                                      '</div>';

                        $(e.target).find('.card-container').prepend(cardHTML);
                        // 加载完毕需要重置
                        $.pullToRefreshDone('.pull-to-refresh-content');
                    }, 2000);
                });


                //多个标签页下的无限滚动
                $(document).on("pageInit", "#page-fixed-tab-infinite-scroll", function (e, id, page) {
                    var loading = false;
                    // 每次加载添加多少条目
                    var itemsPerLoad = 20;
                    // 最多可加载的条目
                    var maxItems = 100;
                    var lastIndex = 0;
                    console.log(lastIndex)
                    function addItems(number, lastIndex) {
                        // 生成新条目的HTML
                        var html = '';
                        for (var i = lastIndex + 1; i <= lastIndex + number; i++) {
                            html += '<li class="item-content""><div class="item-inner"><div class="item-title">新条目</div></div></li>';
                        }
                        // 添加新条目
                        $('.infinite-scroll.active .list-container').append(html);
                    }
                    $(page).on('infinite', function () {
                        // 如果正在加载，则退出
                        if (loading) return;
                        // 设置flag
                        loading = true;
                        var tabIndex = 0;
                        if ($(this).find('.infinite-scroll.active').attr('id') == "tab2") {
                            tabIndex = 0;
                        }
                        if ($(this).find('.infinite-scroll.active').attr('id') == "tab3") {
                            tabIndex = 1;
                        }
                        lastIndex = $('.list-container').eq(tabIndex).find('li').length;
                        // 模拟1s的加载过程
                        setTimeout(function () {
                            // 重置加载flag
                            loading = false;
                            if (lastIndex >= maxItems) {
                                // 加载完毕，则注销无限加载事件，以防不必要的加载
                                //$.detachInfiniteScroll($('.infinite-scroll').eq(tabIndex));
                                // 删除加载提示符
                                $('.infinite-scroll-preloader').eq(tabIndex).hide();
                                //alert('已经加载100条')
                                return;
                            }
                            addItems(itemsPerLoad,1);
                            // 更新最后加载的序号
                            //lastIndex = $('.list-container').eq(tabIndex).find('li').length;
                            $.refreshScroller();
                        }, 1000);
                    });
                });

                $.init();
            });
            $.init();
        })
    </script>
</body>
</html>